<!DOCTYPE html>
<html lang="en" xmlns:sec="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>íšŒì›ê°€ì…</title>
</head>
<body>
<!--ğŸ‘‡ì—¬ê¸°ì— ë‚´ìš© ë„£ì–´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤ğŸ‘‡-->
<section class="py-5">
    <div class="container px-5">
        <!-- login form-->
        <div class="bg-light rounded-3 py-5 px-4 px-md-5 mb-5">
            <div class="row gx-5 justify-content-center">
                <div class="col-lg-8 col-xl-6">
                    <h1 class="text-center mb-5">íšŒì›ê°€ì…</h1>
                    <form id="registerForm" onsubmit="return false">
                        <div class="form-floating mb-3">
                            <input class="form-control" id="userName" name="userName" type="text" onkeyup="idValidCk()" maxlength="20" required placeholder="ì•„ì´ë”” ì…ë ¥">
                            <button class="btn btn-info" id="duplicateCkForId" onclick="duplicateCkForIdFnc()">ì•„ì´ë”” ì¤‘ë³µí™•ì¸</button>
                            <span id="idCkMsg"></span>
                            <label for="userName">ì•„ì´ë””</label>
                        </div>
                        <div class="form-floating mb-3">
                            <input class="form-control" id="password" name="password" type="password" onkeyup="passwordValidCkFnc()" maxlength="20" required placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">
                            <label for="password">íŒ¨ìŠ¤ì›Œë“œ</label>
                        </div>
                        <div class="form-floating mb-3">
                            <input class="form-control" id="passwordCk" name="passwordCk" type="password" maxlength="20" required placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸">
                            <button class="btn btn-info" id="passwordMatchCk" onclick="passwordMatchCkFnc()">íŒ¨ìŠ¤ì›Œë“œ ì¼ì¹˜ì—¬ë¶€ í™•ì¸</button>
                            <span id="passwordCkMsg"></span>
                            <label for="passwordCk">íŒ¨ìŠ¤ì›Œë“œ í™•ì¸</label>
                        </div>
                        <div class="form-floating mb-3">
                            <input class="form-control" id="email" name="email" type="text" onkeyup="emailValidCk()" maxlength="30" required placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”">
                            <button class="btn btn-info" id="duplicateCkForEmail" onclick="duplicateCkForEmailFnc()">ì´ë©”ì¼ ì¤‘ë³µí™•ì¸</button>
                            <span id="emailCkMsg"></span>
                            <label for="email">ì´ë©”ì¼</label>
                        </div>
                        <div class="d-grid"><button class="btn btn-primary btn-lg" id="submitBtn" type="button">íšŒì›ê°€ì…</button></div>
                        <div style="margin-top: 16px; text-align: right"><a href="/findNationalFlag/loginForm">ë¡œê·¸ì¸</a></div>
                    </form>
                </div>
            </div>

        </div>
    </div>
</section>
<!--ğŸ‘†ì—¬ê¸°ì— ë‚´ìš© ë„£ì–´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤ğŸ‘†-->
</body>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script> <!-- jQuery -->
<!--ğŸ‘‡ì—¬ê¸°ì— ì‚¬ìš©í•˜ëŠ” script ë„£ì–´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤ğŸ‘‡-->
<!--ajax-->
<script src="http://code.jquery.com/jquery-latest.min.js"></script>
<script th:inline="javascript">
    window.onload = function () {
        //alert
        const alertMsg = [[${msg}]];

        if (alertMsg){
            alert(alertMsg);
        }
    }

    //ì•„ì´ë”” ì •ê·œì‹ ì²´í¬ìš© flagë³€ìˆ˜
    let idCk = false;
    //ì•„ì´ë”” ì¤‘ë³µí™•ì¸ìš© flagë³€ìˆ˜
    let idDuplicateCk = false;
    //íŒ¨ìŠ¤ì›Œë“œ ì •ê·œì‹ ì²´í¬ìš© flagë³€ìˆ˜
    let passwordCk = false;
    //íŒ¨ìŠ¤ì›Œë“œ ì¤‘ë³µí™•ì¸ìš© flagë³€ìˆ˜
    let passwordMatchCk = false;
    //ì´ë©”ì¼ ì •ê·œì‹ ì²´í¬ìš© flagë³€ìˆ˜
    let emailCk = false;
    //ì´ë©”ì¼ ì¤‘ë³µí™•ì¸ìš© flag ë³€ìˆ˜
    let emailDuplicateCk = false;

    //ì•„ì´ë”” ì¤‘ë³µí™•ì¸
    function duplicateCkForIdFnc(){
        let userName = $('#userName').val(); // idê°’
        if(userName.trim()===''){
            alert('ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!');
        } else {
            $.ajax({
                type : "POST",
                url : "/findNationalFlag/duplicateCkForUserName",
                data : {
                    userName : userName
                },
                success : function (result){
                    if (result===1){ // ì´ë©”ì¼ì´ ì´ë¯¸ ì¡´ì¬í•œë‹¤ë©´
                        alert("ì‚¬ìš© ë¶ˆê°€ëŠ¥í•œ ì•„ì´ë””ì…ë‹ˆë‹¤.");
                        idDuplicateCk = false;
                    } else if(result===0) {
                        alert("ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.");
                        idDuplicateCk = true;
                    } else {
                        alert("ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")
                    }
                },
                error:function (error){
                    alert("ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”!" + error);
                }
            });
        }
    }

    //ì´ë©”ì¼ ì¤‘ë³µí™•ì¸
    function duplicateCkForEmailFnc(){

        let email = $('#email').val();
        if(email.trim()===''){
            alert('ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
        } else {
            $.ajax({
                type : "POST",
                url : "/findNationalFlag/duplicateCkForEmail",
                data : {
                    email : email
                },
                success : function (result){
                    if (result===1){ // ì´ë©”ì¼ì´ ì´ë¯¸ ì¡´ì¬í•œë‹¤ë©´
                        alert("ì‚¬ìš© ë¶ˆê°€ëŠ¥í•œ ì´ë©”ì¼ì…ë‹ˆë‹¤.");
                        emailDuplicateCk = false;
                    } else if(result===0) {
                        alert("ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.");
                        emailDuplicateCk = true;
                    } else {
                        alert("ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")
                    }
                },
                error:function (error){
                    alert("ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”!" + error);
                }
            });
        }
    }

    //íšŒì›ê°€ì… ë²„íŠ¼ í´ë¦­ ì‹œ ë™ì‘
    $('#submitBtn').click(function (event){
        //ê¸°ë³¸ í¼ ì œì¶œ ë°©ì§€
        event.preventDefault();
        const userNameVal = $('#userName').val();
        const passwordVal = $('#password').val();
        const passwordCkVal = $('#passwordCk').val();
        const emailVal = $('#email').val();

        if (
            userNameVal.trim()===''||
            emailVal.trim()===''||
            passwordVal.trim()===''||
            passwordCkVal.trim()===''
        ){
            alert("ë¹„ì–´ìˆëŠ” ê°’ì´ ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”!");
        }
        //ì•„ì´ë”” ì •ê·œì‹ ì²´í¬ ì—¬ë¶€ í™•ì¸
        else if (idCk !== true){
            alert("ì˜¬ë°”ë¥¸ ì•„ì´ë””ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”!")
        }
        //ì•„ì´ë”” ì¤‘ë³µì²´í¬ ì—¬ë¶€ í™•ì¸
        else if (idDuplicateCk !== true){
            alert("ì•„ì´ë”” ì¤‘ë³µì²´í¬ë¥¼ ì§„í–‰í•´ì£¼ì„¸ìš”!")
        }
        //ë¹„ë°€ë²ˆí˜¸ ì •ê·œì‹ ì²´í¬ ì—¬ë¶€ í™•ì¸
        else if (passwordCk !== true){
            alert("ì˜¬ë°”ë¥¸ ë¹„ë°€ë²ˆí˜¸ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”!")
        }
        //ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜ ì²´í¬ ì—¬ë¶€ í™•ì¸
        else if (passwordMatchCk !== true){
            alert("ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜ ì²´í¬ë¥¼ ì§„í–‰í•´ì£¼ì„¸ìš”!")
        }
        //ì´ë©”ì¼ ì •ê·œì‹ ì²´í¬ ì—¬ë¶€ í™•ì¸
        else if (emailCk !== true){
            alert("ì˜¬ë°”ë¥¸ ì´ë©”ì¼ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”!")
        }
        //ì´ë©”ì¼ ì¤‘ë³µ ì²´í¬ ì—¬ë¶€ í™•ì¸
        else if (emailDuplicateCk!==true){
            alert("ì´ë©”ì¼ ì¤‘ë³µì²´í¬ë¥¼ ì§„í–‰í•´ì£¼ì„¸ìš”!")
        } else {

            const formData = {
                userName: userNameVal,
                password: passwordVal,
                passwordCk: passwordCkVal,
                email: emailVal
            };

            $.ajax({
                type : "POST",
                url : "/findNationalFlag/join",
                contentType: "application/json",
                data: JSON.stringify(formData),
                success : function (result){
                    alert("íšŒì›ê°€ì… ë˜ì…¨ìŠµë‹ˆë‹¤!");
                    window.location.href = "/findNationalFlag/login";
                },
                error:function (error){
                    alert("ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤." + error);
                }
            });
        }
    });
    //  });


    //ì•„ì´ë”” ì •ê·œì‹
    function idValidCk() {
        //ì˜ë¬¸ìë¡œ ì‹œì‘í•˜ëŠ” ì˜ë¬¸ì ë˜ëŠ” ìˆ«ì 6~20ì
        const regExp = /^[a-z]+[a-z0-9]{5,19}$/g;
        let userId = $('#userName').val(); // idê°’
        let idCkMsg = $('#idCkMsg');
        if (!regExp.test(userId)){
            idCkMsg.text("ì‚¬ìš©ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤!(ì˜ë¬¸ìì‹œì‘ 6~20ì ì´ë‚´)");
            idCkMsg.css('color', "red");
            idCk = false;
        } else {
            idCkMsg.text("ì‚¬ìš©ê°€ëŠ¥í•©ë‹ˆë‹¤!!");
            idCkMsg.css('color', "blue");
            idCk = true;
        }
    }

    //ë¹„ë°€ë²ˆí˜¸ ì •ê·œì‹
    function passwordValidCkFnc() {
        //ì˜ì–´ ìˆ«ì ì¡°í•© 8ìë¦¬ ì´ìƒ~25ì ì´í•˜
        const regExp = /^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{8,20}$/;
        let password = $('#password').val();
        let passwordCkMsg = $('#passwordCkMsg');
        if (!regExp.test(password)){
            passwordCkMsg.text("ì˜ì–´ ìˆ«ì ì¡°í•© 8~20ì ì´ë‚´ë¡œ í•´ì£¼ì„¸ìš”!");
            passwordCkMsg.css('color', "red");
            passwordCk = false;
        } else {
            passwordCkMsg.text("ì‚¬ìš©ê°€ëŠ¥í•©ë‹ˆë‹¤!!");
            passwordCkMsg.css('color', "blue");
            passwordCk = true;
        }
    }

    //ì´ë©”ì¼ ì •ê·œì‹
    function emailValidCk() {
        //
        const regExp = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/i;
        let userId = $('#email').val(); // idê°’
        let emailCkMsg = $('#emailCkMsg');
        if (!regExp.test(userId)){
            emailCkMsg.text("ì‚¬ìš©ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤!");
            emailCkMsg.css('color', "red");
            emailCk = false;
        } else {
            emailCkMsg.text("ì‚¬ìš©ê°€ëŠ¥í•©ë‹ˆë‹¤!!");
            emailCkMsg.css('color', "blue");
            emailCk = true;
        }
    }

    //íŒ¨ìŠ¤ì›Œë“œ ì¼ì¹˜ì—¬ë¶€ í™•ì¸
    function passwordMatchCkFnc() {
        //ë¹„ë°€ë²ˆí˜¸ ì²´í¬
        let password = document.querySelector("#password").value;
        let passwordCk = document.querySelector("#passwordCk").value;
        if (password !== passwordCk || password === '' || passwordCk === ''){
            alert("íŒ¨ìŠ¤ì›Œë“œê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤!");
            passwordMatchCk = false;
        } else {
            alert("íŒ¨ìŠ¤ì›Œë“œê°€ ì¼ì¹˜í•©ë‹ˆë‹¤! ^^");
            passwordMatchCk = true;
        }
    }
</script>
</html>